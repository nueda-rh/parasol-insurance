= 信頼性確認パイプライン
include::_attributes.adoc[]

== パイプラインは何を行うのか？
すべてが期待通りに動作し、モデルが改ざんされていないことを確認するために、エンドポイントを通してモデルをテストする信頼性確認パイプラインを作成します。 +
レスポンスタイム、レスポンスの質、およびモデルハッシュが変更されていないことをテストします。 +
そして、時間が経過しても同じ状態が維持されることを確認するために、そのパイプラインをスケジュールします。

== 信頼性確認パイプラインのデプロイ

`parasol-insurance/lab-materials/03/06` フォルダには、2つのパイプラインファイル、`confidence_check.pipeline` と `confidence_check.yaml` ファイルがあります。

`.pipeline` ファイルはElyraで開いて視覚的に修正し、実行することができます。一方、 `.yaml` ファイルはRHOAIダッシュボードからパイプラインサーバーにインポートすることができます。
ここでは、Elyraでパイプラインを実行します。

== Elyraとは？

Elyraは、パイプラインを構築するためのビジュアルインターフェースです。標準的なコードエディタにドラッグ＆ドロップ機能が加わったものと考えてください。つまり、Elyraでは何も実行せず、コード（Elyraの場合はjson）を生成するだけです。このコードは、後で実行のために他の場所に送信されます。

Elyraでは、Python、ノートブック、Rファイルをドラッグ＆ドロップでダッシュボードに追加し、ワークフローに接続することができます。
また、右上のボタンからパイプラインと各ステップの追加設定を展開することができます。
[.bordershadow]
image::03/06-elyra-menu.png[]

Elyra を使用すると、プロトタイピングとパイプラインの実行を素早く開始することができます。

== アドホック実行

Elyra を使用して実行することは、パイプラインをインポートして実行するのとは異なり、パイプラインのアドホック実行と同じです。

. 実行中のワークベンチに移動します。
. フォルダ `parasol-insurance/lab-materials/03/06` に移動します。
. `confidence_check.pipeline` ファイルを開きます。
. ここでは、パイプラインが以下の3つのチェックで構成されていることが分かります。
.. response quality check
.. response time check
.. security check
. 各ノードをダブルクリックして、各Pythonファイルの中身を覗いてみてください。
. テストが実行された後、最終的な関数で結果を要約し、ログに記録します。
. パイプラインを実行するには、メニューバーの再生ボタンをクリックします。
+
[.bordershadow]
image::03/07-elyra-pipeline.png[elyra confidence pipeline]
. パイプラインが保存されていないという警告が表示される場合がありますが、これは正常な動作です。この場合は、**[保存して送信]** をクリックしてください。
+
[.bordershadow]
image::03/03-06-unsaved-changes.png[]
. 次のポップアップでは、名前を変更せずに **[OK]** をクリックします。
+
[.bordershadow]
image::03/03-07-run-pipeline-ok.png[]

. 「**ジョブの Data Science Pipelines への送信に成功しました」**というポップアップが表示されたら、「**詳細の実行」**リンクをクリックして、パイプラインの進行状況を確認します。

== 実行のスケジュール

確信度チェックが定期的に実行されるように、実行を**スケジュール**することもできます。
+

実行するには：

. {rhoai} Data Science Projectに戻ります。
. 先ほど実行したパイプラインを見つけます。
. 行の一番最後の3つのドットをクリックし、「実行の作成」をクリックします。
+
[.bordershadow]
image::03/07-create-run.png[create run]

. 次の画面で名前を指定し、**日**ごとに実行される定期実行を選択して、**作成**をクリックします。
+
[.bordershadow]
image::03/03-06-dailyrun.png[]

. これで、信頼性確認パイプラインはそのままにしておきます。
. これは毎日実行され、LLMに何か問題が発生した場合は通知されます。
